<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hotel Booking</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400&family=Roboto:wght@100&family=Cabin+Condensed:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="stylesheets/app.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">


    <!-- 引入 ethers.js 库 -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <!-- Login Button -->
    <button id="loginButton">Login with your wallet</button>

    <h1 class="wave">Hotel Booking</h1>
    <div class="welcome-text">Welcome here, you can begin your journey!</div>

    <!-- Sci-Fi Bar -->
    <div class="sci-fi-bar">
        <span>608lab×技大链协xiaolangzi</span>
    </div>

    <div class="section">Hotel numbers: <span id="numRegistrants">10000</span></div>
    <div id="bookingContent"></div>

    <!-- Corner images -->
    <a href="http://example.com/right-page" target="_blank">
        <img src="images/截图_2025-03-19_14-11-24.png" alt="Right Corner Image" class="corner-image-right">
    </a>
    <a href="https://www.wanglab.fun/" target="_blank">
        <img src="images/粘贴的图像.png" alt="Left Corner Image" class="corner-image-left">
    </a>
    
<!-- 登录成功的小窗口改为输入姓名 -->
<div id="loginSuccessPopup" class="popup">
    <div class="popup-content">
        <h3>欢迎您，如何称呼？</h3>
        <p>请输入您的姓名：</p>
        <input type="text" id="usernameInput" style="padding: 8px; margin: 10px 0; width: 80%;">
        <br>
        <button id="enterButton" style="padding: 8px 16px; cursor: pointer;">进入</button>
    </div>
</div>

        <!-- Load app.js before booking.js -->


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // 为右上角图片添加点击事件，点击后触发缩小效果
            document.querySelector(".corner-image-right").addEventListener("click", function () {
                this.classList.add("shrink");
            });
    
            // 为左上角图片添加点击事件，点击后触发缩小效果
            document.querySelector(".corner-image-left").addEventListener("click", function () {
                this.classList.add("shrink");
            });
    
            // 为登录按钮添加点击事件
            document.getElementById("loginButton").addEventListener("click", async function () {
                // 检查是否安装了 MetaMask
                if (typeof window.ethereum !== 'undefined') {
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
    
                    try {
                        // 请求用户钱包地址
                        const accounts = await provider.send("eth_requestAccounts", []);
                        const userAddress = accounts[0];
    
                        // 弹出提示框显示连接的地址
                        alert("您已经成功连接了您的钱包，可以直接进入");
    
                        // 保存钱包地址到 localStorage
                        localStorage.setItem('walletAddress', userAddress);
    
                        // 显示登录成功的小窗口
                        const popup = document.getElementById('loginSuccessPopup');
                        popup.style.display = 'flex';
    
                        // 设置延时隐藏小窗口并进行后续操作
                        setTimeout(() => {
                            // 不隐藏 popup，而是显示输入框
                            const popup = document.getElementById('loginSuccessPopup');
                            popup.style.display = 'flex';

                            const enterButton = document.getElementById('enterButton');
                            enterButton.addEventListener('click', () => {
                                const username = document.getElementById('usernameInput').value.trim();
                                if (!username) {
                                    alert("请输入您的姓名");
                                    return;
                                }
                                // 保存用户名
                                localStorage.setItem('username', username);

                                // 可选：WebSocket 可省略或保留
                                const socket = new WebSocket('ws://localhost:8545/ws');
                                socket.onopen = function () {
                                    console.log("WebSocket connection established.");
                                    window.location.href = "booking.html";
                                };
                                socket.onerror = function (error) {
                                    console.error("WebSocket error:", error);
                                    alert("WebSocket connection failed.");
                                };
                            });
                        }, 1000); // 显示得稍微快一点更自然
                        // 延迟3秒后执行
    
                    } catch (error) {
                        // 捕获连接钱包时的错误
                        console.error("Error connecting to wallet:", error);
                        alert("Failed to connect to wallet.");
                    }
                } else {
                    // 提示用户安装 MetaMask
                    alert("MetaMask is not installed. Please install MetaMask.");
                }
            });
        });
    </script>
    
    
</body>
</html>
